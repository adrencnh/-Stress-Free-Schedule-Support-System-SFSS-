<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="../static/css/course_preference.css">
    </head>
    <body>
        <div class="error" id="error">Subjects can only contain letters!</div>
        <div class="container">
            <p>Enter all subjects that apply to you:</p>
            <div id="tag-container" class="tag-container">
                <!-- <div class="tag">
                    <span>JavaScript</span>
                    <i class="material-icons">X</i>
                </div> -->
                <input id="userInput">
            </div>
        </div>

        <div class="searchBtn" onclick="searchElective()">Search</div>

        <script>
            const tagContainer = document.getElementById('tag-container')
            const input = document.getElementById('userInput')

            let tags = [];

            input.addEventListener('keyup', function(e) {
                if (e.key === 'Enter') {
                    tags.push(input.value);
                    addTags();
                    input.value = '';
                }
            })

            function addTags() {
                reset();
                tags.slice().reverse().forEach(function(tag) {
                    const input = createTag(tag);
                    tagContainer.prepend(input);
                })
            }

            function reset() {
                document.querySelectorAll('.tag').forEach(function(tag) {
                    tag.parentElement.removeChild(tag);
                })
            }

            function createTag(label) {
                const div = document.createElement('div');
                div.setAttribute('class', 'tag');
                const span = document.createElement('span');
                span.innerHTML = label;
                const closeBtn = document.createElement('i');
                closeBtn.setAttribute('class', 'material-icons');
                closeBtn.setAttribute('data-item', label);
                closeBtn.innerHTML = 'x';

                div.appendChild(span);
                div.appendChild(closeBtn);
                return div;
            }

            document.addEventListener('click', function(e) {
                if (e.target.tagName === 'I') {
                    const value = e.target.getAttribute('data-item');
                    const index = tags.indexOf(value);
                    tags = [...tags.slice(0, index), ...tags.slice(index + 1)];
                    addTags();
                }
            })

            function search() {
                valid = true;

                tags.forEach(function(tag) {
                    if (!validateCourse(tag)) {
                        valid = false;
                    };
                })

                if (valid == true) {
                    searchElective();
                }
                else {
                    document.getElementById('error').style.display = 'block';
                }
            }

            function validateCourse(subject) {
                const re = /^[A-Za-z]+$/;
                return re.test(subject);
            }

            function searchElective() {
                // get_query_results[tags];
            }
        </script>
    </body>
</html>
